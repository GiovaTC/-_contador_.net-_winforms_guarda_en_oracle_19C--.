# -_contador_.net-_winforms_guarda_en_oracle_19C--.  
# Contador .NET (WinForms) — Guarda en Oracle 19C:

<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/d716dc03-9bee-4d47-b74c-15b74f73324e" />  

**Descripción breve**

Aplicación de escritorio en C# (.NET 6/7, WinForms) que cuenta números desde 1 hasta 6325 mostrando el valor en una interfaz gráfica y registrando cada número (o según configuración) en una tabla en Oracle 19c.

---

## Archivos incluidos (en este único archivo encontrarás código y las instrucciones para crear el proyecto):

1. `README` — instrucciones de uso y creación de tabla Oracle
2. `Program.cs` — punto de entrada
3. `MainForm.cs` — formulario WinForms con comportamiento principal

---

## Requisitos:

- .NET 6 o .NET 7 SDK
- Visual Studio 2022 (o 2022/2023) o `dotnet` CLI
- Paquete NuGet: `Oracle.ManagedDataAccess.Core` (para .NET Core/NET 6+)
- Base de datos Oracle 19c accesible y credenciales

---

## SQL: Crear tabla en Oracle 19c:

Ejecuta este script en tu esquema Oracle (puedes usar SQL*Plus, SQL Developer, etc.):

```sql
CREATE TABLE contador_registro (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  numero NUMBER NOT NULL,
  registrado_en TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Opcional: crear usuario y grant (ejemplo)
-- CREATE USER contador_user IDENTIFIED BY strong_password;
-- GRANT CONNECT, RESOURCE TO contador_user;
-- GRANT CREATE TABLE TO contador_user;
```

---

## Cómo crear el proyecto (CLI rápido):

```bash
# Crear proyecto WinForms .NET 7 (o 6)
dotnet new winforms -n ContadorApp
cd ContadorApp
# Añadir Oracle Managed Driver (NET 6/7 compatible)
dotnet add package Oracle.ManagedDataAccess.Core
```

Reemplaza el contenido de `Program.cs` y agrega `MainForm.cs` con el código provisto abajo.

---

## Program.cs

```csharp
using System;
using System.Windows.Forms;

namespace ContadorApp
{
    static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.SetHighDpiMode(HighDpiMode.SystemAware);
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}
```

---

## MainForm.cs

```csharp
using System;
using System.Threading;
using System.Threading.Tasks;
using System.Windows.Forms;
using Oracle.ManagedDataAccess.Client; // paquete Oracle.ManagedDataAccess.Core

namespace ContadorApp
{
    public partial class MainForm : Form
    {
        private CancellationTokenSource _cts;
        private int _current = 0;
        private const int MAX = 6325;

        // Configuración de conexión: reemplaza con tus valores
        private string _connectionString = "User Id=CONTADOR_USER;Password=TU_CONTRASEÑA;Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=tu_host)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=tu_servicio)));";

        // Si prefieres usar TNS name: "User Id=...;Password=...;Data Source=tnsname;"

        public MainForm()
        {
            InitializeComponent();
            // inicializar controles
            btnStart.Click += BtnStart_Click;
            btnStop.Click += BtnStop_Click;
            btnReset.Click += BtnReset_Click;
            btnSaveOnce.Click += BtnSaveOnce_Click;
            chkAutoSave.CheckedChanged += ChkAutoSave_CheckedChanged;

            lblStatus.Text = "Listo";
            UpdateLabel();
        }

        private void ChkAutoSave_CheckedChanged(object sender, EventArgs e)
        {
            // nothing special needed
        }

        private async void BtnStart_Click(object sender, EventArgs e)
        {
            if (_cts != null) return; // ya corriendo

            _cts = new CancellationTokenSource();
            lblStatus.Text = "Corriendo";
            try
            {
                await RunCounterAsync(_cts.Token);
                lblStatus.Text = "Terminado";
            }
            catch (OperationCanceledException)
            {
                lblStatus.Text = "Detenido";
            }
            finally
            {
                _cts.Dispose();
                _cts = null;
            }
        }

        private void BtnStop_Click(object sender, EventArgs e)
        {
            _cts?.Cancel();
        }

        private void BtnReset_Click(object sender, EventArgs e)
        {
            if (_cts != null) return; // no reset mientras corre
            _current = 0;
            UpdateLabel();
            lblStatus.Text = "Reiniciado";
        }

        private async void BtnSaveOnce_Click(object sender, EventArgs e)
        {
            await SaveNumberToOracleAsync(_current);
        }

        private void UpdateLabel()
        {
            if (lblNumber.InvokeRequired)
            {
                lblNumber.Invoke((Action)UpdateLabel);
                return;
            }
            lblNumber.Text = _current.ToString();
            progressBar.Value = Math.Min(MAX, Math.Max(0, (int)(_current * 100 / MAX)));
        }

        private async Task RunCounterAsync(CancellationToken token)
        {
            // velocidad de conteo configurable. Usaremos delay mínimo configurable por el usuario (ms)
            int delayMs = 10; // puedes exponer esto en UI
            while (_current < MAX)
            {
                token.ThrowIfCancellationRequested();
                _current++;
                UpdateLabel();

                if (chkAutoSave.Checked)
                {
                    // guardar en background pero no bloquear GUI
                    _ = SaveNumberToOracleAsync(_current);
                }

                await Task.Delay(delayMs, token);
            }
        }

        private async Task SaveNumberToOracleAsync(int numero)
        {
            // Validar número
            if (numero <= 0) return;

            try
            {
                using (var conn = new OracleConnection(_connectionString))
                {
                    await conn.OpenAsync();
                    using (var cmd = conn.CreateCommand())
                    {
                        cmd.CommandText = "INSERT INTO contador_registro(numero) VALUES(:num)";
                        cmd.Parameters.Add(new OracleParameter("num", numero));
                        await cmd.ExecuteNonQueryAsync();
                    }
                }
                // opcional: mostrar breve confirmación en status sin spam
                ShowTempStatus($"Guardado: {numero}");
            }
            catch (Exception ex)
            {
                // manejar error de BD (no detener la cuenta)
                ShowTempStatus($"Error BD: {ex.Message}");
            }
        }

        private async void ShowTempStatus(string text)
        {
            if (lblStatus.InvokeRequired)
            {
                lblStatus.Invoke((Action)(() => lblStatus.Text = text));
            }
            else lblStatus.Text = text;

            await Task.Delay(1200);

            if (lblStatus.InvokeRequired)
            {
                lblStatus.Invoke((Action)(() => lblStatus.Text = "Corriendo"));
            }
            else if (_cts == null) lblStatus.Text = "Listo";
            else lblStatus.Text = "Corriendo";
        }

        #region Designer (simplificado)

        private System.ComponentModel.IContainer components = null;
        private Label lblNumber;
        private Button btnStart;
        private Button btnStop;
        private Button btnReset;
        private ProgressBar progressBar;
        private CheckBox chkAutoSave;
        private Button btnSaveOnce;
        private Label lblStatus;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            this.lblNumber = new Label();
            this.btnStart = new Button();
            this.btnStop = new Button();
            this.btnReset = new Button();
            this.progressBar = new ProgressBar();
            this.chkAutoSave = new CheckBox();
            this.btnSaveOnce = new Button();
            this.lblStatus = new Label();
            this.SuspendLayout();
            // 
            // lblNumber
            // 
            this.lblNumber.Font = new System.Drawing.Font("Segoe UI", 24F, System.Drawing.FontStyle.Bold);
            this.lblNumber.Location = new System.Drawing.Point(12, 9);
            this.lblNumber.Name = "lblNumber";
            this.lblNumber.Size = new System.Drawing.Size(360, 50);
            this.lblNumber.Text = "0";
            // 
            // btnStart
            // 
            this.btnStart.Location = new System.Drawing.Point(12, 80);
            this.btnStart.Name = "btnStart";
            this.btnStart.Size = new System.Drawing.Size(75, 30);
            this.btnStart.Text = "Iniciar";
            // 
            // btnStop
            // 
            this.btnStop.Location = new System.Drawing.Point(100, 80);
            this.btnStop.Name = "btnStop";
            this.btnStop.Size = new System.Drawing.Size(75, 30);
            this.btnStop.Text = "Detener";
            // 
            // btnReset
            // 
            this.btnReset.Location = new System.Drawing.Point(190, 80);
            this.btnReset.Name = "btnReset";
            this.btnReset.Size = new System.Drawing.Size(75, 30);
            this.btnReset.Text = "Reiniciar";
            // 
            // btnSaveOnce
            // 
            this.btnSaveOnce.Location = new System.Drawing.Point(280, 80);
            this.btnSaveOnce.Name = "btnSaveOnce";
            this.btnSaveOnce.Size = new System.Drawing.Size(92, 30);
            this.btnSaveOnce.Text = "Guardar ahora";
            // 
            // progressBar
            // 
            this.progressBar.Location = new System.Drawing.Point(12, 130);
            this.progressBar.Name = "progressBar";
            this.progressBar.Size = new System.Drawing.Size(360, 23);
            this.progressBar.Minimum = 0;
            this.progressBar.Maximum = 100;
            // 
            // chkAutoSave
            // 
            this.chkAutoSave.Location = new System.Drawing.Point(12, 165);
            this.chkAutoSave.Name = "chkAutoSave";
            this.chkAutoSave.Size = new System.Drawing.Size(140, 24);
            this.chkAutoSave.Text = "Auto-guardar";
            // 
            // lblStatus
            // 
            this.lblStatus.Location = new System.Drawing.Point(12, 200);
            this.lblStatus.Name = "lblStatus";
            this.lblStatus.Size = new System.Drawing.Size(360, 23);
            this.lblStatus.Text = "Estado";
            // 
            // MainForm
            // 
            this.ClientSize = new System.Drawing.Size(384, 231);
            this.Controls.Add(this.lblNumber);
            this.Controls.Add(this.btnStart);
            this.Controls.Add(this.btnStop);
            this.Controls.Add(this.btnReset);
            this.Controls.Add(this.progressBar);
            this.Controls.Add(this.chkAutoSave);
            this.Controls.Add(this.btnSaveOnce);
            this.Controls.Add(this.lblStatus);
            this.FormBorderStyle = FormBorderStyle.FixedDialog;
            this.MaximizeBox = false;
            this.Name = "MainForm";
            this.Text = "Contador 1..6325 - Oracle 19c";
            this.ResumeLayout(false);
        }

        #endregion
    }
}
```

---

## Notas / recomendaciones

- Cambia `_connectionString` por tus credenciales/host/service. Para producción, no guardes la contraseña en texto plano; usa un gestor de secretos o archivo de configuración cifrado.
- `chkAutoSave` hace que cada número se intente insertar en la BD — si tu BD no soporta tantas escrituras, reduce la frecuencia (por ejemplo, insertar solo cada 10 números).
- Si quieres registrar solo al final, desactiva auto-guardar y pulsa "Guardar ahora".
- Considera añadir lógica transaccional o batching para mayor rendimiento .

--- :. 
